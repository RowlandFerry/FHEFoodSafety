# Project Structure

Complete overview of the Food Safety Reporting System project organization.

## Directory Structure

```
food-safety-reporting-system/
├── .github/
│   └── workflows/
│       ├── test.yml                    # Main CI/CD pipeline
│       ├── manual.yml                  # Manual test workflow
│       ├── pull-request.yml            # PR validation
│       └── codeql.yml                  # Security analysis
│
├── contracts/
│   └── AnonymousFoodSafety.sol         # Main FHE contract
│
├── scripts/
│   ├── deploy.js                       # Deployment script
│   ├── verify.js                       # Etherscan verification
│   ├── interact.js                     # Contract interaction examples
│   └── simulate.js                     # Full workflow simulation
│
├── test/
│   ├── FoodSafety.test.js             # Core test suite (33 tests)
│   └── FoodSafety.extended.test.js    # Extended tests (29 tests)
│
├── artifacts/                          # Compiled contracts (generated)
├── cache/                              # Hardhat cache (generated)
├── coverage/                           # Coverage reports (generated)
├── deployments/                        # Deployment info (generated)
├── node_modules/                       # Dependencies
│
├── .env.example                        # Environment template
├── .gitignore                          # Git ignore rules
├── .prettierrc.yml                     # Prettier configuration
├── .prettierignore                     # Prettier ignore rules
├── .solhint.json                       # Solhint configuration
├── .solhintignore                      # Solhint ignore rules
│
├── codecov.yml                         # Codecov configuration
├── hardhat.config.js                   # Hardhat configuration
├── package.json                        # Project dependencies & scripts
├── package-lock.json                   # Dependency lock file
│
├── LICENSE                             # MIT License
├── README.md                           # Main documentation
├── DEPLOYMENT.md                       # Deployment guide
├── TESTING.md                          # Testing documentation
├── TEST_SUMMARY.md                     # Test results summary
├── QUICK_START.md                      # Quick reference
├── CI_CD.md                            # CI/CD documentation
└── PROJECT_STRUCTURE.md                # This file
```

## Key Files

### Configuration Files

| File | Purpose |
|------|---------|
| `hardhat.config.js` | Hardhat configuration with Sepolia network |
| `.solhint.json` | Solidity linting rules |
| `.prettierrc.yml` | Code formatting rules |
| `codecov.yml` | Code coverage thresholds |
| `.env.example` | Environment variables template |

### Smart Contracts

| File | Description | Lines of Code |
|------|-------------|---------------|
| `AnonymousFoodSafety.sol` | Main contract with FHE encryption | ~330 |

**Key Features**:
- Anonymous report submission
- Encrypted data storage (FHE)
- Role-based access control
- Investigation workflow
- Location statistics
- Reporter tracking

### Scripts

| Script | Purpose | Usage |
|--------|---------|-------|
| `deploy.js` | Deploy contract to network | `npm run deploy:sepolia` |
| `verify.js` | Verify on Etherscan | `npm run verify:sepolia` |
| `interact.js` | Interact with deployed contract | `npm run interact:sepolia` |
| `simulate.js` | Run full simulation | `npm run simulate:local` |

### Tests

| File | Tests | Coverage |
|------|-------|----------|
| `FoodSafety.test.js` | 33 | Core functionality |
| `FoodSafety.extended.test.js` | 29 | Edge cases & optimizations |
| **Total** | **62** | **Comprehensive** |

**Test Categories**:
- Deployment & Initialization
- Access Control
- Report Submission
- Investigation Workflow
- Statistics & Queries
- Batch Operations
- Emergency Controls
- Edge Cases
- Gas Optimization

### Documentation

| File | Content |
|------|---------|
| `README.md` | Project overview, features, quick start |
| `DEPLOYMENT.md` | Deployment instructions & troubleshooting |
| `TESTING.md` | Testing guide & best practices |
| `TEST_SUMMARY.md` | Test results & coverage metrics |
| `QUICK_START.md` | Quick reference commands |
| `CI_CD.md` | CI/CD pipeline documentation |
| `LICENSE` | MIT License text |

### GitHub Workflows

| Workflow | Trigger | Purpose |
|----------|---------|---------|
| `test.yml` | Push/PR to main/develop | Full CI/CD pipeline |
| `manual.yml` | Manual dispatch | On-demand testing |
| `pull-request.yml` | Pull requests | PR validation & comments |
| `codeql.yml` | Push/PR/Schedule | Security analysis |

## Generated Directories

These directories are created during build/test:

### `artifacts/`
- Compiled contract ABIs
- Bytecode
- Build info
- Generated by: `npm run compile`

### `cache/`
- Hardhat compilation cache
- Speeds up subsequent builds
- Generated by: `npm run compile`

### `coverage/`
- HTML coverage report
- LCOV format data
- Coverage summary JSON
- Generated by: `npm run test:coverage`

### `deployments/`
- Deployment information
- Contract addresses
- Transaction hashes
- Network details
- Generated by: `npm run deploy:*`

### `typechain-types/` (if TypeScript enabled)
- Generated TypeScript types
- Type-safe contract interactions

## NPM Scripts

### Build & Compilation

```bash
npm run compile      # Compile contracts
npm run clean        # Clean artifacts & cache
npm run size         # Check contract sizes
```

### Testing

```bash
npm test                # Run all tests
npm run test:coverage   # Generate coverage report
npm run test:gas        # Generate gas report
```

### Linting & Formatting

```bash
npm run lint            # Run all linters
npm run lint:sol        # Check Solidity files
npm run lint:fix        # Fix linting issues
npm run prettier:check  # Check formatting
npm run prettier:write  # Fix formatting
npm run format          # Alias for prettier:write
```

### Deployment

```bash
npm run node              # Start local node
npm run deploy:local      # Deploy to localhost
npm run deploy:sepolia    # Deploy to Sepolia
npm run verify:sepolia    # Verify on Etherscan
```

### Interaction

```bash
npm run interact:local    # Interact with local contract
npm run interact:sepolia  # Interact with Sepolia contract
npm run simulate:local    # Run full simulation
```

## Environment Variables

Required in `.env` file:

```env
# Deployment
PRIVATE_KEY=your_private_key_here
SEPOLIA_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/your_api_key

# Verification
ETHERSCAN_API_KEY=your_etherscan_api_key

# Optional
REPORT_GAS=false
COINMARKETCAP_API_KEY=your_coinmarketcap_api_key
```

## Dependencies

### Production Dependencies

```json
{
  "@fhevm/solidity": "^0.8.0",
  "@zama-fhe/oracle-solidity": "^0.2.0",
  "ethers": "^6.15.0"
}
```

### Development Dependencies

**Core Tools**:
- `hardhat@^2.22.0` - Development framework
- `@nomicfoundation/hardhat-toolbox@^6.1.0` - Hardhat plugins bundle

**Testing**:
- `chai@^4.5.0` - Assertion library
- `solidity-coverage@^0.8.16` - Coverage reporting
- `hardhat-gas-reporter@^2.3.0` - Gas usage reporting

**Linting & Formatting**:
- `solhint@^6.0.1` - Solidity linter
- `prettier@^3.6.2` - Code formatter
- `prettier-plugin-solidity@^2.1.0` - Solidity formatting

**TypeScript** (optional):
- `typescript@^5.9.3`
- `ts-node@^10.9.2`
- `@types/node@^20.19.24`
- `@typechain/hardhat@^9.1.0`

## File Sizes

Approximate file sizes:

| Category | Files | Total Size |
|----------|-------|------------|
| Contracts | 1 | ~12 KB |
| Tests | 2 | ~28 KB |
| Scripts | 4 | ~20 KB |
| Documentation | 7 | ~85 KB |
| Workflows | 4 | ~15 KB |
| Configuration | 8 | ~5 KB |

## Code Statistics

```
Total Lines of Code: ~2,500
- Solidity: ~330 lines
- JavaScript: ~1,800 lines
- Documentation: ~3,000 lines
- Configuration: ~200 lines
```

## Git Ignore

Key ignored patterns:

```gitignore
node_modules/
.env
artifacts/
cache/
coverage/
deployments/
typechain/
typechain-types/
*.log
.DS_Store
```

## Security

### Sensitive Files

Never commit:
- `.env` (use `.env.example` instead)
- Private keys
- API keys
- Deployment addresses (use `deployments/` folder with proper .gitignore)

### Audited Files

Files checked by CI/CD:
- ✅ All `.sol` files (Solhint)
- ✅ All JavaScript files (ESLint - if configured)
- ✅ Dependencies (npm audit)
- ✅ Code patterns (CodeQL)

## Maintenance

### Regular Updates

```bash
# Check for outdated dependencies
npm outdated

# Update dependencies
npm update

# Security audit
npm audit

# Fix security issues
npm audit fix
```

### Clean Build

```bash
# Complete clean and rebuild
npm run clean
rm -rf node_modules package-lock.json
npm install
npm run compile
npm test
```

## IDE Setup

### VS Code

Recommended extensions:
- Solidity (Juan Blanco)
- Prettier - Code formatter
- ESLint
- GitLens

### Settings

`.vscode/settings.json`:

```json
{
  "editor.formatOnSave": true,
  "editor.defaultFormatter": "esbenp.prettier-vscode",
  "[solidity]": {
    "editor.defaultFormatter": "JuanBlanco.solidity"
  }
}
```

## Best Practices

### Before Committing

1. ✅ Run `npm run lint`
2. ✅ Run `npm test`
3. ✅ Check `npm run test:coverage`
4. ✅ Review changes with `git diff`
5. ✅ Use conventional commit messages

### Before Deploying

1. ✅ All tests passing
2. ✅ Contract verified on testnet
3. ✅ Gas costs reviewed
4. ✅ Security audit completed
5. ✅ Documentation updated

### Code Review Checklist

- ✅ Tests added for new features
- ✅ Documentation updated
- ✅ No console.log statements
- ✅ Gas optimizations considered
- ✅ Security implications reviewed
- ✅ Code style consistent

## Summary

This project structure provides:

- ✅ **Clear organization** with logical file grouping
- ✅ **Comprehensive documentation** for all aspects
- ✅ **Automated workflows** with GitHub Actions
- ✅ **Quality tools** for linting and formatting
- ✅ **Testing infrastructure** with 62 test cases
- ✅ **Deployment scripts** for multiple networks
- ✅ **Security measures** with auditing and scanning
- ✅ **Developer experience** with clear guidelines

The structure follows industry best practices and supports efficient development, testing, and deployment workflows.
